<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>web APP 阅读器</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,minimal-ui">  <!-- minimal-ui是隐藏上下边栏 -->
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="normalize.css">
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<nav class="nav-top" id="top_nav" style="display: none;">	
		<div class="icon-back"></div>
		<div class="nav-title">返回书架</div>
	</nav>
	<section class="container" id="root">
		<div class="m-artical-action">      <!-- //点击显示上下边栏 -->
			<div class="artical-action-mid" id="action_mid"></div>
		</div>
		<div class="m-read-title"></div>
		<div class="m-read-content" id="fiction_container">
			<h4>第004章 绝处逢生？</h4>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
			<p>夜已深，漆黑一片，景物不可见。但山中并不宁静，猛兽咆哮，震动山河，万木摇颤，乱叶簌簌坠落。群山万壑间，洪荒猛兽横行，太古遗种出没，各种可怕的声音在黑暗中此起彼伏，直欲裂开这天地。山脉中，远远望去有一团柔和的光隐现，在这黑暗无尽的夜幕下与万山间犹如一点烛火在摇曳，随时会熄灭。渐渐接近，可以看清那里有半截巨大的枯木，树干直径足有十几米，通体焦黑。除却半截主干外，它只剩下了一条柔弱的枝条，但却在散发着生机，枝叶晶莹如绿玉刻成，点点柔和的光扩散，将一个村子笼罩。</p>
		</div>
		<div class="m-button-bar">		
			<ul class="u-tab clearfix">
				<li id="prev-button"><a href="">上一章</a></li>
				<li id="next-button"><a href="">下一章</a></li>
			</ul>
		</div>
	</section>
	<div class="nav-pannel" style="display: none;" id="font-container">
		<div class="child-mod">
			<span>字号</span>
			<button class="font-size-button spe-button" id="large-font">大</button>
			<button class="font-size-button spe-button" id="small-font">小</button>
		</div>
		<div class="child-mod child-mod-bk" id="bk-container">
			<span>背景</span>
			<div class="bk-container">
				<div class="bk-container-current"></div>
			</div>
			<div class="bk-container">
				<div class="bk-container-current"></div>
			</div>
			<div class="bk-container">
				<div class="bk-container-current"></div>
			</div>
			<div class="bk-container">
				<div class="bk-container-current"></div>
			</div>
			<div class="bk-container">
				<div class="bk-container-current"></div>
			</div>
		</div>
	</div>
	<nav class="nav-bottom" style="display: none;" id="bottom_nav">
		<ul class="nav-tab clearfix">
			<li>
				<a href="#">
					<span class="icon-img1"></span>
					<p>目录</p>
				</a>
			</li>
			<li id="font-button">
				<a href="javascript:;">
					<span class="icon-img2"></span>
					<p>字体</p>
				</a>
			</li>
			<li id="night-button">
				<a href="#">
					<span class="icon-img3"></span>
					<p>夜间</p>
				</a>
			</li>
		</ul>
	</nav>
</body>
<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript">
	window.jQuery = $;
</script>
<script type="text/javascript" src="js/jquery.base64.js"></script>
<script type="text/javascript" src="js/jquery.jsonp.js"></script>
<script type="text/javascript">
	(function(){
		var Util = (function(){
			 var prefix = 'html5_reader_';   // 加前缀为了不和其他的key重叠
			 var StorageGetter = function(key){
			 	return localStorage.getItem(prefix + key);
			 }
			 var StorageSetter = function(key,val){
			 	return localStorage.setItem(prefix + key,val);
			 }
			 return {
			 	StorageGetter:StorageGetter,   //把函数暴露出去，变成全局可用
			 	StorageSetter:StorageSetter
			 }
		})();
		var DOM = {
			top_nav:$('#top_nav'),
			bottom_nav:$('#bottom_nav'),
			font_button:$('#font-button'),
			font_container:$('#font-container'),
			bk_container:$('#bk-container'),
			night_button:$('#night-button')
		}
		win = $(window);
		doc = $(document); 
		initFontSize = Util.StorageGetter("font_size");
		initFontSize = parseInt(initFontSize);
		if(!initFontSize){
			initFontSize = 14;
		}
		//是否是夜间模式
		var NightMode = false;
		$('#fiction_container').css("font-size",initFontSize);
		//从缓存中读取信息进行展示
		var ModuleFontSwitch = function(){
			//字体和颜色表
			var colorArr = [{
				value : '#f7eee5',
				name : '米白',
				font : ''
			},{
				value : '#e9dfc7',
				name : '纸张',
				font : ''
			},{
				value : '#a4a4a4',
				name : '浅灰',
				font : ''
			},{
				value : '#cdefce',
				name : '护眼',
				font : ''
			},{
				value : '#283548',
				name : '灰蓝',
				font : '#7685a2',
				bottomcolor : '#fff'
			},{
				value : '#0f1410',
				name : '夜间',
				font : '#4e534f',
				bottomcolor : 'rgba(255,255,255,0.7)',
				id : "font_night"
			}]
		}

		var tool_bar = StorageGetter('toolbar_background_color');



      

		function main(){

			

			//整个项目的入口函数
			EventHander();

		}

		function ReaderModel(){
			//实现和阅读器相关的数据交互的方法

		}

		function ReaderBaseFrame(){
			//渲染基本的UI结构
		}

		function EventHander(){
			//交互事件的绑定
			$('#action_mid').click(function(){    //上下边栏出现效果
				if(DOM.top_nav.css("display") == "none"){
					DOM.top_nav.show();
					DOM.bottom_nav.show();
				}else{
					DOM.top_nav.hide();
					DOM.bottom_nav.hide();
					DOM.font_container.hide();
					DOM.font_button.find('span').removeClass("cur");
				}
			});
			//下边栏字体点击效果
			DOM.font_button.click(function(){
				if(DOM.font_container.css("display") == "none"){

					DOM.font_container.show();
					DOM.font_button.find('span').addClass("cur");
				}else{
					DOM.font_container.hide();
					DOM.font_button.find('span').removeClass("cur");
				}
			})
			// 夜间模式按钮点击
			DOM.night_button.click(function(){
				if(NightMode){
					DOM.night_button.find('span').addClass('cur');
					DOM.night_button.find('p').text("白天");
					$('#bottom_tool_bar_ul').css('opacity', '0.6');
					NightMode = false;
				}else{
					DOM.night_button.find('span').removeClass('cur');
					DOM.night_button.find('p').text("夜间");
					$('#bottom_tool_bar_ul').css('opacity', '0.6');
					NightMode = true;
				}
			})
			//背景切换 （delegate是给后面.bk-container绑定一个或者多个事件，也包括后面添加的.bk-container）
			DOM.bk_container.delegate('.bk-container','click',function(){   
				var color = $(this).data('color');  //字体颜色
				var font = $(this).data('font');	//暂时不知道。
				var bottomcolor = $(this).data('bottomcolor'); //暂时用于 上一页，下一页按钮样式
				var tool_bar = font;
				DOM.bk_container.find('.bk-container-current').hide();
				$(this).find('.bk-container-current').show();

				$('body').css('background',color);		 //整个body的背景颜色
				$('.m-read-content').css('color',font);  //正文的字体颜色

				//把tool_bar,bottomcolor,color.font存入localStorage
				Util.StorageSetter('toolbar_background_color',tool_bar);
				Util.StorageSetter('bottom_color',bottomcolor);
				Util.StorageSetter('background_color',color);
				Util.StorageSetter('font_color',font);

				//夜间模式
				var fontColor = Util.StorageGetter('font_color');
				if(fontColor == '#4e534f'){  //变成白天模式
					NightMode = true;		//上面有设置NightMode=false;
					DOM.night_button.find('span').addClass('cur');
					DOM.night_button.find('p').text("白天");
					$('#bottom_tool_bar_ul').css('opacity', '0.6');
				}else{
					NightMode = false;
					DOM.night_button.find('span').removeClass('cur');
					DOM.night_button.find('p').text("夜间");
					$('#bottom_tool_bar_ul').css('opacity', '0.6');
				}
			})


			//按钮的多态样式效果
			$('.spe-button').on('touchstart', function() {
				$(this).css('background', 'rgba(255,255,255,0.3)');
			}).on('touchmove', function() {
				$(this).css('background', 'none');
			}).on('touchend', function() {
				$(this).css('background', 'none');
			});

			//字体变大
			$("#large-font").click(function(){
				if(initFontSize >= 20){
					return;
				}
				initFontSize += 1;
				$('#fiction_container').css("font-size",initFontSize);
				Util.StorageSetter("font_size",initFontSize);
			});
			//字体变小
			$("#small-font").click(function(){
				if(initFontSize <= 12){
					return;
				}
				initFontSize -= 1;
				$('#fiction_container').css("font-size",initFontSize);
				Util.StorageSetter("font_size",initFontSize);
			});
			win.scroll(function(){
				DOM.top_nav.hide();
				DOM.bottom_nav.hide();
				DOM.font_container.hide();
				DOM.font_button.find('span').removeClass("cur");
			})
		}



		main();



	})()
</script>
</html>